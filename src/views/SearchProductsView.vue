<template>
  <div class="container mt-5">
    <div class="input-group mb-3">
      <input type="text" class="form-control" placeholder="Search for product" aria-label="Search for product"
        aria-describedby="button-addon2" v-model="searchStr">
      <div class="input-group-append">
        <button class="btn btn-search" type="button" id="button-addon2">üîç</button>
      </div>
    </div>

    <div class="card">
      <ul class="list-group">
        <li class="list-group-item flex-column flex-lg-row "
          v-for="(product, index) in products" :key="index">
          <div class="card-img">
            <img src="https://picsum.photos/300/300" class="img-fluid" alt="product image">
          </div>
          <div class="card-body">

            <div class="product-name text-uppercase">
              {{ product.name }}
            </div>
            <div class="price-piece">

              <!-- List all stores name and price -->
              <div class="store" v-for="(store, index) in product.stores" :key="index">
                <div class="store-name ">
                  {{ store.name }}
                </div>
                <div class="store-price">
                  {{ store.price }},-
                </div>
                </div>

            </div>
            <!-- Add to cart button -->
            <button class="ms-lg-0 ms-5 mt-3 float-end btn-transparent btn btn-dark btn-add" @click="this.addToCart(product)">+</button>
          </div>
        </li>
      </ul>

      <div class="no-results" v-if="products.length == 0">
        <p>No products found...</p>
      </div>
    </div>
  </div>
</template>

<script>
export default {
  name: "ProductsView",
  components: {},
  data() {
    return {
      searchStr: '',
      products: [
        { name: 'Oksek√∏d', price: 40, stores: [{name: "Lidl", price: 40}, {name: "Netto", price: 35}, {name: "Rema 1000", price: 30}] }, { name: 'Banan', stores: [{name: "Lidl", price: 5}, {name: "Netto", price: 4}, {name: "Rema 1000", price: 3}] }
      ]
    };
  },
  methods: {
    search(productFilter) {
      console.log('searching for', this.searchStr);
      // Filter products
      this.products = this.products.filter(product => {
        return product.name.toLowerCase().includes(productFilter.toLowerCase());
      });
    },
    // add to cart
    addToCart(product) {
      this.$store.dispatch("addToCart", product);
      console.log('add to cart', product);
    }
  },
  watch: {
    searchStr: function (newVal, oldVal) {
      console.log('searchStr changed', newVal, oldVal);

      if (newVal != '') {
        this.search(newVal);
      } else {
        this.products = [
          { name: 'Oksek√∏d', price: 40, stores: [{name: "Lidl", price: 40}, {name: "Netto", price: 35}, {name: "Rema 1000", price: 30}] }, { name: 'Banan', stores: [{name: "Lidl", price: 5}, {name: "Netto", price: 4}, {name: "Rema 1000", price: 3}] }
        ];
      }



    }
  }
};
</script>

<style scoped>
.store {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.product-name {
  font-size: 1.2rem;
  font-weight: bold;
}

.price-piece {
  font-size: 1.2rem;
  font-weight: bold;
  color: #545454;
}

.btn-search {
  background-color: white;
  color: #000;
  border-radius: 0 10px 10px 0px;
  border: 1px solid #ced4da;
  border-left: 0 !important;
}

.btn-search:hover {
  background-color: #ced4da;
}

.btn-add {
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  width: 35px;
  height: 35px;
  font-size: 1.2rem;
  background-color: darkgreen;
  border: 1px solid #ced4da;
}

.card {
  margin-top: 20px;
}

.list-group-item {
  display: flex;
}

.card-img {
  width: 200px;
  margin-right: 10px;
}

.card-img img {
  border-radius: 6px;
}

.card-body {
  width: calc(100%-200px);
  margin-top: 10px;
}

.no-results {
  text-align: center;
  margin-top: 20px;
  color: #545454;
}
</style>